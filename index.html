<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Siddh's Welcome Guide - Best Western Hopkinsville</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            text-align: center;
            margin: 0;
            padding: 20px;
            background-color: #f8f8f8;
            color: #333;
        }
        .container {
            max-width: 650px;
            margin: 30px auto;
            padding: 30px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border-top: 5px solid #0056b3;
        }
        h1 {
            color: #0056b3;
            margin-bottom: 5px;
        }
        .subtitle {
            color: #e67e22;
            font-size: 1.1em;
            margin-top: 0;
            margin-bottom: 25px;
            font-weight: normal;
        }
        .instructions {
            text-align: left;
            margin: 25px 0;
            padding: 20px;
            background-color: #f0f7ff;
            border-radius: 6px;
            border-left: 4px solid #0056b3;
        }
        .key {
            display: inline-block;
            width: 42px;
            height: 42px;
            margin: 5px;
            line-height: 42px;
            text-align: center;
            background-color: #0056b3;
            color: white;
            border-radius: 5px;
            font-weight: bold;
            font-size: 1.1em;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .key.space {
            width: 140px;
            background-color: #e67e22;
        }
        .audio-file {
            color: #555;
            font-style: italic;
            margin-left: 8px;
        }
        #status {
            min-height: 24px;
            padding: 12px;
            background-color: #f5f5f5;
            border-radius: 4px;
            margin-top: 20px;
            font-weight: bold;
        }
        .voice-status {
            margin: 20px 0;
            padding: 10px;
            background-color: #f0f7ff;
            border-radius: 6px;
        }
        .listening-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: #e74c3c;
            margin-right: 8px;
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            70% { transform: scale(1.5); opacity: 0.7; }
            100% { transform: scale(1); opacity: 1; }
        }
        .voice-commands {
            margin-top: 15px;
            font-size: 0.9em;
            color: #666;
        }
        .permission-button {
            background-color: #2ecc71;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 10px 0;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Siddh's Welcome Guide</h1>
        <p class="subtitle">Best Western Hopkinsville</p>
        
        <div class="voice-status">
            <div id="micStatus">
                <span class="listening-indicator"></span>
                <span id="micStatusText">Microphone access required</span>
            </div>
            <button id="permissionButton" class="permission-button">Enable Microphone</button>
            <div class="voice-commands">
                Try saying: "welcome", "breakfast", or "stop"
            </div>
        </div>
        
        <div class="instructions">
            <p>Press these keys for quick information:</p>
            <p><span class="key">M</span><span class="audio-file">Main Introduction (intro.mp3)</span></p>
            <p><span class="key">W</span><span class="audio-file">Welcome Message (welcome.mp3)</span></p>
            <p><span class="key">E</span><span class="audio-file">Elevator Locations (elevator.mp3)</span></p>
            <p><span class="key">B</span><span class="audio-file">Breakfast Information (breakfast.mp3)</span></p>
            <p><span class="key">R</span><span class="audio-file">Restaurant Guide (restaurant.mp3)</span></p>
            <p><span class="key">H</span><span class="audio-file">Helpful Tips (helpful.mp3)</span></p>
            <p><span class="key">S</span><span class="audio-file">Stay Details (stay.mp3)</span></p>
            <p><span class="key">D</span><span class="audio-file">Directions (entrance.mp3)</span></p>
            <p><span class="key space">SPACE</span><span class="audio-file">Stop Audio</span></p>
        </div>
        
        <p id="status">Ready to assist you</p>
    </div>

    <script>
        // Audio file mapping
        const audioMap = {
            'm': 'intro.mp3',
            'w': 'welcome.mp3',
            'e': 'elevator.mp3',
            'b': 'breakfast.mp3',
            'r': 'restaurant.mp3',
            'h': 'helpful.mp3',
            's': 'stay.mp3',
            'd': 'entrance.mp3'
        };

        // Command phrases mapping
        const commandMap = {
            'main introduction': 'm',
            'intro': 'm',
            'welcome': 'w',
            'welcome message': 'w',
            'elevator': 'e',
            'elevator location': 'e',
            'elevator locations': 'e',
            'breakfast': 'b',
            'breakfast information': 'b',
            'restaurant': 'r',
            'restaurant guide': 'r',
            'helpful': 'h',
            'helpful tips': 'h',
            'stay': 's',
            'stay details': 's',
            'directions': 'd',
            'entrance': 'd',
            'stop': 'stop',
            'pause': 'stop'
        };

        // Global variables
        let currentAudio = null;
        let recognition = null;
        let isLocalFile = window.location.protocol === 'file:';

        // DOM elements
        const micStatusText = document.getElementById('micStatusText');
        const permissionButton = document.getElementById('permissionButton');
        const statusElement = document.getElementById('status');

        // Check if running as local file
        if (isLocalFile) {
            micStatusText.innerHTML = '<span style="color:#e74c3c">Note: For Android, use a web server (see instructions)</span>';
        }

        // Request microphone permission
        permissionButton.addEventListener('click', function() {
            requestMicrophonePermission();
        });

        function requestMicrophonePermission() {
            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                navigator.mediaDevices.getUserMedia({ audio: true })
                    .then(function(stream) {
                        // Permission granted
                        permissionButton.style.display = 'none';
                        micStatusText.textContent = 'Always listening for commands';
                        
                        // Stop all tracks to release the microphone
                        stream.getTracks().forEach(track => track.stop());
                        
                        // Initialize voice recognition
                        initVoiceRecognition();
                    })
                    .catch(function(err) {
                        console.error("Microphone access denied", err);
                        micStatusText.innerHTML = '<span style="color:#e74c3c">Microphone access denied. Please enable permissions.</span>';
                        
                        if (isLocalFile) {
                            micStatusText.innerHTML += '<br><span style="color:#e67e22">For local files on Android, use a web server or Firefox browser</span>';
                        }
                    });
            } else {
                micStatusText.innerHTML = '<span style="color:#e74c3c">Microphone access not supported</span>';
                permissionButton.style.display = 'none';
            }
        }

        // Initialize voice recognition
        function initVoiceRecognition() {
            try {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                recognition.continuous = true;
                recognition.interimResults = false;
                recognition.maxAlternatives = 1;

                recognition.onstart = function() {
                    statusElement.textContent = 'Listening for commands...';
                };

                recognition.onresult = function(event) {
                    const speechResult = event.results[event.results.length - 1][0].transcript.toLowerCase().trim();
                    statusElement.textContent = `Heard: "${speechResult}"`;
                    
                    // Find the best matching command
                    let matchedKey = null;
                    for (const [phrase, key] of Object.entries(commandMap)) {
                        if (speechResult.includes(phrase)) {
                            matchedKey = key;
                            break;
                        }
                    }
                    
                    if (matchedKey === 'stop') {
                        stopAudio();
                    } else if (matchedKey !== null) {
                        playAudio(matchedKey);
                    }
                };

                recognition.onerror = function(event) {
                    console.error('Speech recognition error', event.error);
                    if (event.error === 'not-allowed') {
                        statusElement.textContent = 'Microphone access denied';
                        micStatusText.innerHTML = '<span style="color:#e74c3c">Microphone access denied. Please refresh and allow access.</span>';
                    } else {
                        statusElement.textContent = `Error: ${event.error}`;
                    }
                    
                    // Try to restart recognition after error
                    setTimeout(() => {
                        if (recognition) recognition.start();
                    }, 1000);
                };

                recognition.onend = function() {
                    // Automatically restart recognition when it ends
                    if (recognition) recognition.start();
                };

                // Start recognition
                recognition.start();

            } catch(e) {
                console.error('Speech recognition not supported', e);
                micStatusText.innerHTML = '<span style="color:#e74c3c">Voice commands not supported</span>';
                statusElement.textContent = 'Voice commands not supported in this browser';
            }
        }

        function stopAudio() {
            if (currentAudio) {
                currentAudio.pause();
                currentAudio.currentTime = 0;
                currentAudio = null;
                statusElement.textContent = 'Audio stopped';
            }
        }

        function playAudio(key) {
            // Stop currently playing audio if any
            stopAudio();
            
            // Play the corresponding audio file
            const audioFile = audioMap[key];
            currentAudio = new Audio(audioFile);
            currentAudio.play()
                .then(() => {
                    statusElement.textContent = `Playing: ${getAudioDescription(key)}`;
                })
                .catch(error => {
                    statusElement.textContent = `Error: Could not play audio`;
                    console.error('Audio playback error:', error);
                });
        }

        function getAudioDescription(key) {
            const descriptions = {
                'm': 'Main Introduction',
                'w': 'Welcome Message',
                'e': 'Elevator Locations',
                'b': 'Breakfast Information',
                'r': 'Restaurant Guide',
                'h': 'Helpful Tips',
                's': 'Stay Details',
                'd': 'Directions'
            };
            return descriptions[key] || 'Audio Guide';
        }

        // Handle key presses
        document.addEventListener('keydown', function(event) {
            const key = event.key.toLowerCase();
            
            // Spacebar pressed - stop audio
            if (event.code === 'Space') {
                event.preventDefault();
                stopAudio();
                return;
            }
            
            // Regular key press for audio playback
            if (audioMap.hasOwnProperty(key)) {
                playAudio(key);
            }
        });

        // For local files, show special instructions
        if (isLocalFile) {
            const instructions = document.querySelector('.instructions');
            const localFileWarning = document.createElement('div');
            localFileWarning.innerHTML = `
                <div style="background-color: #fff8e1; padding: 10px; border-radius: 5px; margin-top: 15px; text-align: left;">
                    <strong>Android Users:</strong> For microphone to work, please:<br>
                    1. Use Firefox browser, OR<br>
                    2. Serve this file through a web server<br>
                    <small>Chrome blocks microphone access for local files</small>
                </div>
            `;
            instructions.appendChild(localFileWarning);
        }
    </script>
</body>
</html>